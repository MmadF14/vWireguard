{{define "title"}}
<span data-translate="Wireguard Clients">Wireguard Clients</span>
{{end}}

{{define "top_css"}}
<style>
    .client-card {
        background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255,255,255,0.1);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .client-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        border-color: rgba(249,115,22,0.3);
    }
    
    .dark .client-card {
        background: linear-gradient(135deg, rgba(30,41,59,0.8) 0%, rgba(51,65,85,0.6) 100%);
        border: 1px solid rgba(71,85,105,0.3);
    }
    
    .dark .client-card:hover {
        box-shadow: 0 20px 40px rgba(0,0,0,0.4);
        border-color: rgba(249,115,22,0.4);
    }
    
    .status-badge {
        position: relative;
        overflow: hidden;
    }
    
    .status-badge::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
        transition: left 0.5s;
    }
    
    .status-badge:hover::before {
        left: 100%;
    }
    
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
    }
    
    .stat-card {
        background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
        border-radius: 1rem;
        padding: 1.5rem;
        color: white;
        position: relative;
        overflow: hidden;
    }
    
    .stat-card::before {
        content: '';
        position: absolute;
        top: 0;
        right: 0;
        width: 100px;
        height: 100px;
        background: rgba(255,255,255,0.1);
        border-radius: 50%;
        transform: translate(30px, -30px);
    }
    
    .stat-card::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        width: 60px;
        height: 60px;
        background: rgba(255,255,255,0.05);
        border-radius: 50%;
        transform: translate(-20px, 20px);
    }
    
    .search-input {
        background: rgba(255,255,255,0.1);
        border: 1px solid rgba(255,255,255,0.2);
        backdrop-filter: blur(10px);
    }
    
    .search-input:focus {
        background: rgba(255,255,255,0.15);
        border-color: #f97316;
        box-shadow: 0 0 0 3px rgba(249,115,22,0.1);
    }
    
    .action-button {
        transition: all 0.2s ease;
        position: relative;
        overflow: hidden;
    }
    
    .action-button::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        background: rgba(255,255,255,0.2);
        border-radius: 50%;
        transform: translate(-50%, -50%);
        transition: width 0.3s ease, height 0.3s ease;
    }
    
    .action-button:hover::before {
        width: 100%;
        height: 100%;
    }
    
    .action-button:hover {
        transform: scale(1.05);
    }
    
    .client-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 1.5rem;
        margin-top: 2rem;
    }
    
    @media (max-width: 768px) {
        .client-grid {
            grid-template-columns: 1fr;
        }
        
        .stats-grid {
            grid-template-columns: 1fr;
        }
    }
    
    .pulse-animation {
        animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
    }
    
    .loading-spinner {
        border: 3px solid rgba(249,115,22,0.3);
        border-top: 3px solid #f97316;
        border-radius: 50%;
        width: 20px;
        height: 20px;
        animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
</style>
{{end}}

{{define "username"}}
{{ .username }}
{{end}}

{{define "page_title"}}
<span data-translate="Wireguard Clients">Wireguard Clients</span>
{{end}}

{{define "page_content"}}
<div class="space-y-6">
    <!-- Statistics Dashboard -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="flex items-center justify-between relative z-10">
                <div>
                    <h3 class="text-lg font-semibold mb-1" data-translate="Total Clients">Total Clients</h3>
                    <p class="text-3xl font-bold" id="total-clients">0</p>
                    <p class="text-sm opacity-80" data-translate="Active connections">Active connections</p>
                </div>
                <div class="bg-white bg-opacity-20 p-3 rounded-xl">
                    <i class="fas fa-users text-2xl"></i>
                </div>
            </div>
        </div>
        
        <div class="stat-card bg-gradient-to-r from-green-500 to-emerald-600">
            <div class="flex items-center justify-between relative z-10">
                <div>
                    <h3 class="text-lg font-semibold mb-1" data-translate="Online">Online</h3>
                    <p class="text-3xl font-bold" id="online-clients">0</p>
                    <p class="text-sm opacity-80" data-translate="Currently connected">Currently connected</p>
                </div>
                <div class="bg-white bg-opacity-20 p-3 rounded-xl">
                    <i class="fas fa-wifi text-2xl"></i>
                </div>
            </div>
        </div>
        
        <div class="stat-card bg-gradient-to-r from-blue-500 to-cyan-600">
            <div class="flex items-center justify-between relative z-10">
                <div>
                    <h3 class="text-lg font-semibold mb-1" data-translate="Data Transfer">Data Transfer</h3>
                    <p class="text-3xl font-bold" id="total-transfer">0 GB</p>
                    <p class="text-sm opacity-80" data-translate="Total bandwidth used">Total bandwidth used</p>
                </div>
                <div class="bg-white bg-opacity-20 p-3 rounded-xl">
                    <i class="fas fa-chart-line text-2xl"></i>
                </div>
            </div>
        </div>
        
        <div class="stat-card bg-gradient-to-r from-purple-500 to-indigo-600">
            <div class="flex items-center justify-between relative z-10">
                <div>
                    <h3 class="text-lg font-semibold mb-1" data-translate="Server Status">Server Status</h3>
                    <p class="text-2xl font-bold" id="server-status">
                        <i class="fas fa-circle text-green-400 mr-2"></i>
                        <span data-translate="Active">Active</span>
                    </p>
                    <p class="text-sm opacity-80" data-translate="Wireguard service">Wireguard service</p>
                </div>
                <div class="bg-white bg-opacity-20 p-3 rounded-xl">
                    <i class="fas fa-server text-2xl"></i>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Controls Section -->
    <div class="bg-white dark:bg-dark-800 rounded-2xl shadow-lg p-6 border border-gray-200 dark:border-dark-700">
        <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
            <div class="flex flex-col sm:flex-row gap-4">
                <!-- Search -->
                <div class="relative">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <i class="fas fa-search text-gray-400"></i>
                    </div>
                    <input type="text" id="search-input" class="block w-full pl-10 pr-3 py-2 border border-gray-300 dark:border-dark-600 rounded-xl leading-5 bg-white dark:bg-dark-700 placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 dark:text-white" placeholder="Search clients..." data-translate-placeholder="Search clients...">
                </div>
                
                <!-- Status Filter -->
                <select id="status-filter" class="block w-full sm:w-auto px-3 py-2 border border-gray-300 dark:border-dark-600 rounded-xl bg-white dark:bg-dark-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent">
                    <option value="all" data-translate="All Status">All Status</option>
                    <option value="online" data-translate="Online">Online</option>
                    <option value="offline" data-translate="Offline">Offline</option>
                    <option value="enabled" data-translate="Enabled">Enabled</option>
                    <option value="disabled" data-translate="Disabled">Disabled</option>
                </select>
            </div>
            
            <div class="flex items-center gap-3">
                <!-- Auto Refresh Toggle -->
                <div class="flex items-center">
                    <label for="auto-refresh" class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="auto-refresh" class="sr-only peer">
                        <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary-300 dark:peer-focus:ring-primary-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary-600"></div>
                        <span class="ml-3 text-sm font-medium text-gray-700 dark:text-gray-300" data-translate="Auto Refresh">Auto Refresh</span>
                    </label>
                </div>
                
                <!-- Refresh Button -->
                <button id="refresh-btn" class="inline-flex items-center px-4 py-2 border border-gray-300 dark:border-dark-600 rounded-xl shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-dark-700 hover:bg-gray-50 dark:hover:bg-dark-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-all duration-200">
                    <i class="fas fa-sync-alt mr-2"></i>
                    <span data-translate="Refresh">Refresh</span>
                </button>
            </div>
        </div>
    </div>
    
    <!-- Loading State -->
    <div id="loading-state" class="hidden">
        <div class="flex justify-center items-center py-12">
            <div class="loading-spinner"></div>
            <span class="ml-3 text-gray-600 dark:text-gray-400" data-translate="Loading clients...">Loading clients...</span>
        </div>
    </div>
    
    <!-- Clients Grid -->
    <div id="clients-container" class="client-grid">
        <!-- Clients will be loaded here via JavaScript -->
    </div>
    
    <!-- Empty State -->
    <div id="empty-state" class="hidden text-center py-12">
        <div class="bg-white dark:bg-dark-800 rounded-2xl shadow-lg p-8 border border-gray-200 dark:border-dark-700">
            <div class="w-24 h-24 bg-gradient-to-br from-primary-500 to-primary-600 rounded-full flex items-center justify-center mx-auto mb-6">
                <i class="fas fa-user-plus text-white text-3xl"></i>
            </div>
            <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-2" data-translate="No clients found">No clients found</h3>
            <p class="text-gray-500 dark:text-gray-400 mb-6" data-translate="Get started by creating your first Wireguard client">Get started by creating your first Wireguard client</p>
            <button onclick="document.getElementById('modal_new_client').style.display='block'" class="inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-xl text-white bg-gradient-to-r from-primary-500 to-primary-600 hover:from-primary-600 hover:to-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all duration-200">
                <i class="fas fa-plus mr-2"></i>
                <span data-translate="Create First Client">Create First Client</span>
            </button>
        </div>
    </div>
</div>

<!-- Client Action Modals -->
<div id="modal_edit_client" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
    <div class="bg-white dark:bg-dark-800 rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto custom-scrollbar">
        <div class="flex items-center justify-between p-6 border-b border-gray-200 dark:border-dark-700">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white">
                <i class="fas fa-edit text-primary-500 mr-2"></i>
                <span data-translate="Edit Client">Edit Client</span>
            </h3>
            <button onclick="document.getElementById('modal_edit_client').style.display='none'" class="p-2 hover:bg-gray-100 dark:hover:bg-dark-700 rounded-lg">
                <i class="fas fa-times text-gray-400"></i>
            </button>
        </div>
        
        <form id="edit-client-form" class="p-6 space-y-6">
            <input type="hidden" id="edit-client-id" name="client_id">
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="edit-client-name" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        <span data-translate="Client Name">Client Name</span>
                    </label>
                    <input type="text" id="edit-client-name" name="client_name" class="block w-full px-3 py-2 border border-gray-300 dark:border-dark-600 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent bg-white dark:bg-dark-700 text-gray-900 dark:text-white">
                </div>
                
                <div>
                    <label for="edit-client-email" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        <span data-translate="Email Address">Email Address</span>
                    </label>
                    <input type="email" id="edit-client-email" name="client_email" class="block w-full px-3 py-2 border border-gray-300 dark:border-dark-600 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent bg-white dark:bg-dark-700 text-gray-900 dark:text-white">
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="edit-client-quota" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        <span data-translate="Quota (GB)">Quota (GB)</span>
                    </label>
                    <input type="number" id="edit-client-quota" name="client_quota" class="block w-full px-3 py-2 border border-gray-300 dark:border-dark-600 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent bg-white dark:bg-dark-700 text-gray-900 dark:text-white" step="0.1" min="0">
                </div>
                
                <div>
                    <label for="edit-client-expiry" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        <span data-translate="Expiry Days">Expiry Days</span>
                    </label>
                    <input type="number" id="edit-client-expiry" name="client_expiry" class="block w-full px-3 py-2 border border-gray-300 dark:border-dark-600 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent bg-white dark:bg-dark-700 text-gray-900 dark:text-white" min="0">
                </div>
            </div>
            
            <div>
                <label for="edit-client-notes" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                    <span data-translate="Notes">Notes</span>
                </label>
                <textarea id="edit-client-notes" name="client_notes" rows="3" class="block w-full px-3 py-2 border border-gray-300 dark:border-dark-600 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent bg-white dark:bg-dark-700 text-gray-900 dark:text-white resize-none"></textarea>
            </div>
            
            <div class="flex items-center space-x-6">
                <div class="flex items-center">
                    <input type="checkbox" id="edit-client-enabled" name="client_enabled" class="h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded">
                    <label for="edit-client-enabled" class="ml-2 text-sm text-gray-700 dark:text-gray-300">
                        <span data-translate="Enabled">Enabled</span>
                    </label>
                </div>
                
                <div class="flex items-center">
                    <input type="checkbox" id="edit-client-dns" name="client_dns" class="h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded">
                    <label for="edit-client-dns" class="ml-2 text-sm text-gray-700 dark:text-gray-300">
                        <span data-translate="Use Server DNS">Use Server DNS</span>
                    </label>
                </div>
            </div>
            
            <div class="flex justify-end space-x-3 pt-6">
                <button type="button" onclick="document.getElementById('modal_edit_client').style.display='none'" class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-dark-700 border border-gray-300 dark:border-dark-600 rounded-xl hover:bg-gray-50 dark:hover:bg-dark-600">
                    <span data-translate="Cancel">Cancel</span>
                </button>
                <button type="submit" class="px-4 py-2 text-sm font-medium text-white bg-gradient-to-r from-primary-500 to-primary-600 border border-transparent rounded-xl hover:from-primary-600 hover:to-primary-700 shadow-lg hover:shadow-xl">
                    <i class="fas fa-save mr-2"></i>
                    <span data-translate="Save Changes">Save Changes</span>
                </button>
            </div>
        </form>
    </div>
</div>

<!-- QR Code Modal -->
<div id="modal_qr_code" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
    <div class="bg-white dark:bg-dark-800 rounded-2xl shadow-2xl w-full max-w-md">
        <div class="flex items-center justify-between p-6 border-b border-gray-200 dark:border-dark-700">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white">
                <i class="fas fa-qrcode text-primary-500 mr-2"></i>
                <span data-translate="QR Code">QR Code</span>
            </h3>
            <button onclick="document.getElementById('modal_qr_code').style.display='none'" class="p-2 hover:bg-gray-100 dark:hover:bg-dark-700 rounded-lg">
                <i class="fas fa-times text-gray-400"></i>
            </button>
        </div>
        
        <div class="p-6 text-center">
            <div class="bg-gray-100 dark:bg-dark-700 rounded-xl p-4 mb-4">
                <img id="qr-code-image" src="" alt="QR Code" class="w-full h-auto max-w-xs mx-auto">
            </div>
            <p class="text-sm text-gray-600 dark:text-gray-400" data-translate="Scan this QR code with your Wireguard client">Scan this QR code with your Wireguard client</p>
        </div>
    </div>
</div>
{{end}}

{{define "bottom_js"}}
<script>
// Global variables
let clients = [];
let filteredClients = [];
let autoRefreshInterval = null;
let isLoading = false;

// DOM elements
const clientsContainer = document.getElementById('clients-container');
const loadingState = document.getElementById('loading-state');
const emptyState = document.getElementById('empty-state');
const searchInput = document.getElementById('search-input');
const statusFilter = document.getElementById('status-filter');
const autoRefreshToggle = document.getElementById('auto-refresh');
const refreshBtn = document.getElementById('refresh-btn');

// Statistics elements
const totalClientsEl = document.getElementById('total-clients');
const onlineClientsEl = document.getElementById('online-clients');
const totalTransferEl = document.getElementById('total-transfer');
const serverStatusEl = document.getElementById('server-status');

// Initialize
document.addEventListener('DOMContentLoaded', function() {
    loadClients();
    bindEvents();
    updateStats();
});

// Bind events
function bindEvents() {
    searchInput.addEventListener('input', debounce(filterClients, 300));
    statusFilter.addEventListener('change', filterClients);
    autoRefreshToggle.addEventListener('change', toggleAutoRefresh);
    refreshBtn.addEventListener('click', loadClients);
}

// Load clients from server
async function loadClients() {
    if (isLoading) return;
    
    isLoading = true;
    showLoading();
    
    try {
        const response = await fetch(`${basePath}/api/clients`);
        if (response.ok) {
            const data = await response.json();
            clients = data.clients || [];
            filteredClients = [...clients];
            renderClients();
            updateStats();
        } else {
            throw new Error('Failed to load clients');
        }
    } catch (error) {
        console.error('Error loading clients:', error);
        showError('Failed to load clients. Please try again.');
    } finally {
        isLoading = false;
        hideLoading();
    }
}

// Show loading state
function showLoading() {
    loadingState.classList.remove('hidden');
    clientsContainer.classList.add('hidden');
    emptyState.classList.add('hidden');
}

// Hide loading state
function hideLoading() {
    loadingState.classList.add('hidden');
    clientsContainer.classList.remove('hidden');
}

// Filter clients
function filterClients() {
    const searchTerm = searchInput.value.toLowerCase();
    const statusFilterValue = statusFilter.value;
    
    filteredClients = clients.filter(client => {
        const matchesSearch = client.name.toLowerCase().includes(searchTerm) ||
                             client.email.toLowerCase().includes(searchTerm) ||
                             client.allocated_ips.some(ip => ip.includes(searchTerm));
        
        const matchesStatus = statusFilterValue === 'all' || 
                             client.status === statusFilterValue ||
                             (statusFilterValue === 'enabled' && client.enabled) ||
                             (statusFilterValue === 'disabled' && !client.enabled);
        
        return matchesSearch && matchesStatus;
    });
    
    renderClients();
}

// Render clients
function renderClients() {
    if (filteredClients.length === 0) {
        clientsContainer.classList.add('hidden');
        emptyState.classList.remove('hidden');
        return;
    }
    
    clientsContainer.classList.remove('hidden');
    emptyState.classList.add('hidden');
    
    clientsContainer.innerHTML = filteredClients.map(client => createClientCard(client)).join('');
}

// Create client card HTML
function createClientCard(client) {
    const isOnline = client.status === 'online';
    const statusColor = isOnline ? 'bg-green-500' : 'bg-gray-400';
    const statusText = isOnline ? 'Online' : 'Offline';
    const transferData = formatBytes(client.transfer_rx + client.transfer_tx);
    
    return `
        <div class="client-card bg-white dark:bg-dark-800 rounded-2xl shadow-lg border border-gray-200 dark:border-dark-700 overflow-hidden">
            <!-- Client Header -->
            <div class="p-6 border-b border-gray-200 dark:border-dark-700">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <div class="relative">
                            <div class="w-12 h-12 bg-gradient-to-br from-primary-500 to-primary-600 rounded-xl flex items-center justify-center text-white font-bold text-lg">
                                ${client.name.charAt(0).toUpperCase()}
                            </div>
                            <div class="absolute -bottom-1 -right-1 w-4 h-4 ${statusColor} rounded-full border-2 border-white dark:border-dark-800"></div>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white">${client.name}</h3>
                            <p class="text-sm text-gray-500 dark:text-gray-400">${client.email}</p>
                        </div>
                    </div>
                    
                    <div class="flex items-center space-x-2">
                        <span class="status-badge px-3 py-1 text-xs font-medium rounded-full ${isOnline ? 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200' : 'bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-200'}">
                            ${statusText}
                        </span>
                        <div class="flex items-center space-x-1">
                            <button onclick="editClient('${client.id}')" class="action-button p-2 text-gray-400 hover:text-primary-500 rounded-lg hover:bg-gray-100 dark:hover:bg-dark-700">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="showQRCode('${client.id}')" class="action-button p-2 text-gray-400 hover:text-primary-500 rounded-lg hover:bg-gray-100 dark:hover:bg-dark-700">
                                <i class="fas fa-qrcode"></i>
                            </button>
                            <button onclick="toggleClient('${client.id}')" class="action-button p-2 text-gray-400 hover:text-primary-500 rounded-lg hover:bg-gray-100 dark:hover:bg-dark-700">
                                <i class="fas fa-${client.enabled ? 'pause' : 'play'}"></i>
                            </button>
                            <button onclick="deleteClient('${client.id}')" class="action-button p-2 text-gray-400 hover:text-red-500 rounded-lg hover:bg-gray-100 dark:hover:bg-dark-700">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Client Details -->
            <div class="p-6 space-y-4">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <p class="text-sm text-gray-500 dark:text-gray-400">IP Address</p>
                        <p class="text-sm font-medium text-gray-900 dark:text-white">${client.allocated_ips.join(', ')}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500 dark:text-gray-400">Data Transfer</p>
                        <p class="text-sm font-medium text-gray-900 dark:text-white">${transferData}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500 dark:text-gray-400">Last Seen</p>
                        <p class="text-sm font-medium text-gray-900 dark:text-white">${client.last_handshake || 'Never'}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500 dark:text-gray-400">Quota</p>
                        <p class="text-sm font-medium text-gray-900 dark:text-white">${client.quota ? formatBytes(client.quota) : 'Unlimited'}</p>
                    </div>
                </div>
                
                ${client.notes ? `
                <div class="bg-gray-50 dark:bg-dark-700 rounded-xl p-3">
                    <p class="text-sm text-gray-700 dark:text-gray-300">${client.notes}</p>
                </div>
                ` : ''}
            </div>
        </div>
    `;
}

// Update statistics
function updateStats() {
    const totalClients = clients.length;
    const onlineClients = clients.filter(c => c.status === 'online').length;
    const totalTransfer = clients.reduce((sum, c) => sum + c.transfer_rx + c.transfer_tx, 0);
    
    totalClientsEl.textContent = totalClients;
    onlineClientsEl.textContent = onlineClients;
    totalTransferEl.textContent = formatBytes(totalTransfer);
    
    // Animate counters
    animateCounter(totalClientsEl, totalClients);
    animateCounter(onlineClientsEl, onlineClients);
}

// Animate counter
function animateCounter(element, target) {
    const start = parseInt(element.textContent) || 0;
    const duration = 1000;
    const startTime = performance.now();
    
    function update(currentTime) {
        const elapsed = currentTime - startTime;
        const progress = Math.min(elapsed / duration, 1);
        const current = Math.floor(start + (target - start) * progress);
        
        element.textContent = current;
        
        if (progress < 1) {
            requestAnimationFrame(update);
        }
    }
    
    requestAnimationFrame(update);
}

// Toggle auto refresh
function toggleAutoRefresh() {
    if (autoRefreshToggle.checked) {
        autoRefreshInterval = setInterval(loadClients, 10000); // 10 seconds
    } else {
        clearInterval(autoRefreshInterval);
    }
}

// Client actions
function editClient(clientId) {
    const client = clients.find(c => c.id === clientId);
    if (!client) return;
    
    document.getElementById('edit-client-id').value = client.id;
    document.getElementById('edit-client-name').value = client.name;
    document.getElementById('edit-client-email').value = client.email;
    document.getElementById('edit-client-quota').value = client.quota ? client.quota / (1024 * 1024 * 1024) : '';
    document.getElementById('edit-client-expiry').value = client.expiry_days || '';
    document.getElementById('edit-client-notes').value = client.notes || '';
    document.getElementById('edit-client-enabled').checked = client.enabled;
    document.getElementById('edit-client-dns').checked = client.use_server_dns;
    
    document.getElementById('modal_edit_client').style.display = 'block';
}

function showQRCode(clientId) {
    const client = clients.find(c => c.id === clientId);
    if (!client) return;
    
    document.getElementById('qr-code-image').src = `${basePath}/api/client/${clientId}/qr`;
    document.getElementById('modal_qr_code').style.display = 'block';
}

function toggleClient(clientId) {
    const client = clients.find(c => c.id === clientId);
    if (!client) return;
    
    // Toggle client enabled state
    fetch(`${basePath}/api/client/${clientId}/toggle`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            loadClients();
            showSuccess(`Client ${client.enabled ? 'disabled' : 'enabled'} successfully`);
        } else {
            showError('Failed to toggle client');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        showError('Failed to toggle client');
    });
}

function deleteClient(clientId) {
    const client = clients.find(c => c.id === clientId);
    if (!client) return;
    
    if (confirm(`Are you sure you want to delete client "${client.name}"?`)) {
        fetch(`${basePath}/api/client/${clientId}`, {
            method: 'DELETE',
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                loadClients();
                showSuccess('Client deleted successfully');
            } else {
                showError('Failed to delete client');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            showError('Failed to delete client');
        });
    }
}

// Utility functions
function formatBytes(bytes) {
    if (bytes === 0) return '0 B';
    const k = 1024;
    const sizes = ['B', 'KB', 'MB', 'GB', 'TB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}

function showSuccess(message) {
    // You can integrate with a toast library here
    console.log('Success:', message);
}

function showError(message) {
    // You can integrate with a toast library here
    console.error('Error:', message);
}

// Global base path
const basePath = '{{.basePath}}';

// Handle edit client form submission
document.getElementById('edit-client-form').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    const clientId = formData.get('client_id');
    
    fetch(`${basePath}/api/client/${clientId}`, {
        method: 'PUT',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            name: formData.get('client_name'),
            email: formData.get('client_email'),
            quota: formData.get('client_quota') ? parseFloat(formData.get('client_quota')) * 1024 * 1024 * 1024 : null,
            expiry_days: formData.get('client_expiry') ? parseInt(formData.get('client_expiry')) : null,
            notes: formData.get('client_notes'),
            enabled: formData.get('client_enabled') === 'on',
            use_server_dns: formData.get('client_dns') === 'on',
        }),
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            document.getElementById('modal_edit_client').style.display = 'none';
            loadClients();
            showSuccess('Client updated successfully');
        } else {
            showError('Failed to update client');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        showError('Failed to update client');
    });
});
</script>
{{end}}