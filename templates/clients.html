{{define "title"}}
<span data-translate="Wireguard Clients">Wireguard Clients</span>
{{end}}

{{define "top_css"}}
{{end}}

{{define "username"}}
{{ .username }}
{{end}}

{{define "page_title"}}
<span data-translate="Wireguard Clients">Wireguard Clients</span>
{{end}}

{{define "page_content"}}
<section class="content">
    <div class="container-fluid">
        <!-- <h5 class="mt-4 mb-2">Wireguard Clients</h5> -->
        <div class="mb-4 flex justify-end items-center space-x-4 rtl:space-x-reverse">
            <label class="inline-flex items-center cursor-pointer">
                <input type="checkbox" id="auto-refresh-toggle" class="h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded">
                <span class="ml-2 rtl:ml-0 rtl:mr-2 text-sm" data-translate="Auto Refresh">Auto Refresh</span>
            </label>
            <select id="refresh-interval" class="px-2 py-1 text-sm border border-gray-300 dark:border-dark-600 rounded-xl bg-white dark:bg-dark-700 text-gray-700 dark:text-gray-300 focus:outline-none" disabled>
                <option value="5" data-translate="5 seconds">5 seconds</option>
                <option value="10" data-translate="10 seconds">10 seconds</option>
                <option value="30" data-translate="30 seconds">30 seconds</option>
                <option value="60" data-translate="60 seconds">60 seconds</option>
            </select>
            <button type="button" id="refresh-status-btn" class="px-4 py-2 text-sm font-medium text-primary-600 border border-primary-500 rounded-xl hover:bg-primary-50 dark:hover:bg-dark-700 flex items-center space-x-2 rtl:space-x-reverse">
                <i class="fas fa-sync-alt"></i>
                <span data-translate="Refresh Status">Refresh Status</span>
            </button>
        </div>

        <!-- Search and Filter Row -->
        <div class="mb-6 grid grid-cols-1 md:grid-cols-8 gap-4 hidden" id="search-form">
            <div class="md:col-span-5">
                <div class="relative">
                    <span class="absolute inset-y-0 left-0 rtl:left-auto rtl:right-0 flex items-center pl-3 rtl:pl-0 rtl:pr-3 text-gray-400">
                        <i class="fas fa-search"></i>
                    </span>
                    <input type="text" id="search-input" class="block w-full pl-10 rtl:pl-3 rtl:pr-10 text-sm border border-gray-300 dark:border-dark-600 rounded-xl bg-white dark:bg-dark-700 text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent" placeholder="Search clients..." data-translate-placeholder="Search clients...">
                </div>
            </div>
            <div class="md:col-span-3">

                <select id="status-filter" class="block w-full px-3 py-2 text-sm border border-gray-300 dark:border-dark-600 rounded-xl bg-white dark:bg-dark-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent">

                <select id="status-selector" class="block w-full px-3 py-2 text-sm border border-gray-300 dark:border-dark-600 rounded-xl bg-white dark:bg-dark-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent">

                    <option value="All" data-translate="All">All</option>
                    <option value="Enabled" data-translate="Enabled">Enabled</option>
                    <option value="Disabled" data-translate="Disabled">Disabled</option>
                    <option value="Connected" data-translate="Connected">Connected</option>
                    <option value="Disconnected" data-translate="Disconnected">Disconnected</option>
                </select>
            </div>
        </div>

        <div id="loading-state" class="hidden flex flex-col items-center py-10">
            <i class="fas fa-spinner fa-spin text-gray-500 text-xl"></i>
            <span class="mt-2 text-gray-500 dark:text-gray-400" data-translate="Loading...">Loading...</span>
        </div>
        <div id="empty-state" class="hidden text-center py-10">
            <span class="text-gray-500 dark:text-gray-400" data-translate="No clients found">No clients found</span>
        </div>

        <div id="clients-container" class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
        </div>
        <!-- /.row -->
    </div>
</section>

<div id="modal_email_client" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
    <div class="bg-white dark:bg-dark-800 rounded-2xl shadow-2xl w-full max-w-md">
        <div class="flex items-center justify-between p-6 border-b border-gray-200 dark:border-dark-700">
            <h4 class="text-lg font-semibold text-gray-900 dark:text-white" data-translate="Email Configuration">Email Configuration</h4>
            <button type="button" onclick="document.getElementById('modal_email_client').style.display='none'" class="p-2 hover:bg-gray-100 dark:hover:bg-dark-700 rounded-lg">
                <i class="fas fa-times text-gray-400"></i>
            </button>
        </div>
        <form name="frm_email_client" id="frm_email_client" class="p-6 space-y-4">
            <input type="hidden" id="e_client_id" name="e_client_id">
            <div>
                <label for="e_client_email" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" data-translate="Email address">Email address</label>
                <input type="text" id="e_client_email" name="e_client_email" class="block w-full px-3 py-2 border border-gray-300 dark:border-dark-600 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent bg-white dark:bg-dark-700 text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-gray-500">
            </div>
            <div class="flex justify-end space-x-3 rtl:space-x-reverse">
                <button type="button" onclick="document.getElementById('modal_email_client').style.display='none'" class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-dark-700 border border-gray-300 dark:border-dark-600 rounded-xl hover:bg-gray-50 dark:hover:bg-dark-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500" data-translate="Cancel">Cancel</button>
                <button type="submit" class="px-4 py-2 text-sm font-medium text-white bg-gradient-to-r from-primary-500 to-primary-600 border border-transparent rounded-xl hover:from-primary-600 hover:to-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500" data-translate="Send">Send</button>
            </div>
        </form>
    </div>
</div>

<div id="modal_qr_code" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
    <div class="bg-white dark:bg-dark-800 rounded-2xl shadow-2xl w-full max-w-md">
        <div class="flex items-center justify-between p-6 border-b border-gray-200 dark:border-dark-700">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white">
                <span data-translate="QR Code">QR Code</span>
            </h3>
            <button type="button" onclick="document.getElementById('modal_qr_code').style.display='none'" class="p-2 hover:bg-gray-100 dark:hover:bg-dark-700 rounded-lg">
                <i class="fas fa-times text-gray-400"></i>
            </button>
        </div>
        <div class="p-6 text-center">
            <input type="hidden" id="qr_client_id" name="qr_client_id">
            <div class="bg-gray-100 dark:bg-dark-700 rounded-xl p-4 mb-4">
                <img id="qr_code" class="w-full h-auto max-w-xs mx-auto" style="image-rendering: pixelated;" src="" alt="QR code" />
            </div>
            <p class="text-sm text-gray-600 dark:text-gray-400" data-translate="Scan this QR code with your Wireguard client">Scan this QR code with your Wireguard client</p>
        </div>
    </div>
</div>


<div id="modal_telegram_client" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
    <div class="bg-white dark:bg-dark-800 rounded-2xl shadow-2xl w-full max-w-md">
        <div class="flex items-center justify-between p-6 border-b border-gray-200 dark:border-dark-700">
            <h4 class="text-lg font-semibold text-gray-900 dark:text-white" data-translate="Telegram Configuration">Telegram Configuration</h4>
            <button type="button" onclick="document.getElementById('modal_telegram_client').style.display='none'" class="p-2 hover:bg-gray-100 dark:hover:bg-dark-700 rounded-lg">
                <i class="fas fa-times text-gray-400"></i>
            </button>
=======
<div class="modal fade" id="modal_telegram_client">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" data-translate="Telegram Configuration">Telegram Configuration</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <form name="frm_telegram_client" id="frm_telegram_client">
                <div class="modal-body">
                    <input type="hidden" id="tg_client_id" name="tg_client_id">
                    <div class="form-group">
                        <label for="tg_client_userid" class="control-label" data-translate="Telegram userid">Telegram userid</label>
                        <input type="text" class="block w-full px-3 py-2 border border-gray-300 dark:border-dark-600 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent bg-white dark:bg-dark-700 text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-gray-500" id="tg_client_userid" name="tg_client_userid">
                    </div>
                </div>
                <div class="modal-footer justify-content-between">
                    <button type="button" class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-dark-700 border border-gray-300 dark:border-dark-600 rounded-xl hover:bg-gray-50 dark:hover:bg-dark-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500" data-dismiss="modal" data-translate="Cancel">Cancel</button>
                    <button type="submit" class="px-4 py-2 text-sm font-medium text-white bg-gradient-to-r from-primary-500 to-primary-600 border border-transparent rounded-xl hover:from-primary-600 hover:to-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500" data-translate="Send">Send</button>
                </div>
            </form>

        </div>
        <form name="frm_telegram_client" id="frm_telegram_client" class="p-6 space-y-4">
            <input type="hidden" id="tg_client_id" name="tg_client_id">
            <div>
                <label for="tg_client_userid" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" data-translate="Telegram userid">Telegram userid</label>
                <input type="text" id="tg_client_userid" name="tg_client_userid" class="block w-full px-3 py-2 border border-gray-300 dark:border-dark-600 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent bg-white dark:bg-dark-700 text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-gray-500">
            </div>
            <div class="flex justify-end space-x-3 rtl:space-x-reverse">
                <button type="button" onclick="document.getElementById('modal_telegram_client').style.display='none'" class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-dark-700 border border-gray-300 dark:border-dark-600 rounded-xl hover:bg-gray-50 dark:hover:bg-dark-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500" data-translate="Cancel">Cancel</button>
                <button type="submit" class="px-4 py-2 text-sm font-medium text-white bg-gradient-to-r from-primary-500 to-primary-600 border border-transparent rounded-xl hover:from-primary-600 hover:to-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500" data-translate="Send">Send</button>
            </div>
        </form>
    </div>
</div>

<div id="modal_edit_client" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4 overflow-y-auto">
    <div class="bg-white dark:bg-dark-800 rounded-2xl shadow-2xl w-full max-w-2xl">
        <div class="flex items-center justify-between p-6 border-b border-gray-200 dark:border-dark-700">
            <h4 class="text-lg font-semibold text-gray-900 dark:text-white" data-translate="Edit Client">Edit Client</h4>
            <button type="button" onclick="document.getElementById('modal_edit_client').style.display='none'" class="p-2 hover:bg-gray-100 dark:hover:bg-dark-700 rounded-lg">
                <i class="fas fa-times text-gray-400"></i>
            </button>
        </div>
        <form name="frm_edit_client" id="frm_edit_client" class="p-6 space-y-4 overflow-y-auto max-h-screen">
            <input type="hidden" id="_client_id" name="_client_id">
            <div class="space-y-4">
                    <div class="form-group">
                        <label for="_client_name" class="control-label" data-translate="Name">Name</label>
                        <input type="text" class="block w-full px-3 py-2 border border-gray-300 dark:border-dark-600 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent bg-white dark:bg-dark-700 text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-gray-500" id="_client_name" name="_client_name">
                    </div>
                    <div class="form-group">
                        <label for="_client_email" class="control-label" data-translate="Email">Email</label>
                        <input type="text" class="block w-full px-3 py-2 border border-gray-300 dark:border-dark-600 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent bg-white dark:bg-dark-700 text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-gray-500" id="_client_email" name="client_email">
                    </div>
                    <div class="form-group">
                        <label for="_client_quota" class="control-label" data-translate="Quota">Quota</label>
                        <select class="block w-full px-3 py-2 border border-gray-300 dark:border-dark-600 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent bg-white dark:bg-dark-700 text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-gray-500" id="_quota_preset" onchange="updateQuotaInput()">
                            <option value="" data-translate="Select Quota">Select Quota</option>
                            <option value="10">10 GB</option>
                            <option value="20">20 GB</option>
                            <option value="30">30 GB</option>
                            <option value="40">40 GB</option>
                            <option value="50">50 GB</option>
                            <option value="100">100 GB</option>
                            <option value="200">200 GB</option>
                            <option value="500">500 GB</option>
                            <option value="1000">1 TB</option>
                            <option value="custom" data-translate="Custom">Custom</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <input type="number" class="block w-full px-3 py-2 border border-gray-300 dark:border-dark-600 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent bg-white dark:bg-dark-700 text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-gray-500" id="_client_quota" name="_client_quota" data-translate-placeholder="Enter custom quota in GB" placeholder="Enter custom quota in GB" step="0.1" min="0" />
                    </div>

                    <div class="form-group">
                        <label for="_client_expiration_days" class="control-label" data-translate="Expiration Days">Expiration Days</label>
                        <input type="number" class="block w-full px-3 py-2 border border-gray-300 dark:border-dark-600 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent bg-white dark:bg-dark-700 text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-gray-500" id="_client_expiration_days" name="_client_expiration_days" placeholder="e.g. 30" min="0" />
                    </div>

                    <div class="form-group">
                        <label for="_client_allocated_ips" class="control-label" data-translate="IP Allocation">IP Allocation</label>
                        <input type="text" data-role="tagsinput" class="block w-full px-3 py-2 border border-gray-300 dark:border-dark-600 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent bg-white dark:bg-dark-700 text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-gray-500" id="_client_allocated_ips">
                    </div>
                    <div class="form-group">
                        <label for="_client_endpoint" class="control-label" data-translate="Endpoint">Endpoint</label>
                        <input type="text" class="block w-full px-3 py-2 border border-gray-300 dark:border-dark-600 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent bg-white dark:bg-dark-700 text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-gray-500" id="_client_endpoint" name="client_endpoint">
                    </div>
                    <div class="form-group" style="margin-top: 0.5rem;">
                        <label for="_client_telegram_userid" class="control-label" data-translate="Telegram userid">Telegram userid</label>
                        <input type="text" class="block w-full px-3 py-2 border border-gray-300 dark:border-dark-600 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent bg-white dark:bg-dark-700 text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-gray-500" id="_client_telegram_userid" name="_client_telegram_userid">
                    </div>
                    <div class="form-group">
                        <label for="_additional_notes" class="control-label" data-translate="Notes">Notes</label>
                        <textarea class="block w-full px-3 py-2 border border-gray-300 dark:border-dark-600 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent bg-white dark:bg-dark-700 text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-gray-500" style="min-height: 6rem;" id="_additional_notes" name="_additional_notes" data-translate-placeholder="Additional notes about this client" placeholder="Additional notes about this client"></textarea>
                    </div>
                    <div class="form-group">
                        <div class="icheck-primary d-inline">
                            <input type="checkbox" id="_use_server_dns">
                            <label for="_use_server_dns" data-translate="Use server DNS">
                                Use server DNS
                            </label>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="icheck-primary d-inline">
                            <input type="checkbox" id="_enabled">
                            <label for="_enabled" data-translate="Enable this client">
                                Enable this client
                            </label>
                        </div>
                    </div>
                    <details>
                        <summary>
                            <strong data-translate="Public and Preshared Keys">Public and Preshared Keys</strong>
                            <i class="fas fa-info-circle" data-toggle="tooltip"
                               data-translate-title="Update the server stored client Public and Preshared keys."
                               data-original-title="Update the server stored client Public and Preshared keys.">
                            </i>
                        </summary>
                        <div class="form-group" style="margin-top: 1rem">
                            <label for="_client_public_key" class="control-label" data-translate="Public Key">
                                Public Key
                            </label>
                            <input type="text" class="block w-full px-3 py-2 border border-gray-300 dark:border-dark-600 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent bg-white dark:bg-dark-700 text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-gray-500" id="_client_public_key" name="_client_public_key" aria-invalid="false">
                        </div>
                        <div class="form-group">
                            <label for="_client_preshared_key" class="control-label" data-translate="Preshared Key">
                                Preshared Key
                            </label>
                            <input type="text" class="block w-full px-3 py-2 border border-gray-300 dark:border-dark-600 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent bg-white dark:bg-dark-700 text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-gray-500" id="_client_preshared_key" name="_client_preshared_key">
                        </div>
                    </details>
                    <details style="margin-top: 0.5rem;">
                        <summary>
                            <strong data-translate="Additional configuration">Additional configuration</strong>
                        </summary>
                        <div class="form-group">
                            <label for="_client_allowed_ips" class="control-label" data-translate="Allowed IPs">Allowed IPs</label>
                            <input type="text" data-role="tagsinput" class="block w-full px-3 py-2 border border-gray-300 dark:border-dark-600 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent bg-white dark:bg-dark-700 text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-gray-500" id="_client_allowed_ips">
                        </div>
                        <div class="form-group">
                            <label for="_client_extra_allowed_ips" class="control-label" data-translate="Extra Allowed IPs">Extra Allowed IPs</label>
                            <input type="text" data-role="tagsinput" class="block w-full px-3 py-2 border border-gray-300 dark:border-dark-600 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent bg-white dark:bg-dark-700 text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-gray-500"
                                   id="_client_extra_allowed_ips">
                        </div>
                        <div class="form-group">
                            <label for="_subnet_ranges" class="control-label" data-translate="Subnet range">Subnet range</label>
                            <select id="_subnet_ranges" class="select2"
                                    data-translate-placeholder="Select a subnet range"
                                    data-placeholder="Select a subnet range" style="width: 100%;">
                            </select>
                        </div>
                    </details>
                </div>

            <div class="flex justify-end space-x-3 rtl:space-x-reverse pt-4">
                <button type="button" onclick="document.getElementById('modal_edit_client').style.display='none'" class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-dark-700 border border-gray-300 dark:border-dark-600 rounded-xl hover:bg-gray-50 dark:hover:bg-dark-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500" data-translate="Cancel">Cancel</button>
                <button type="submit" class="px-4 py-2 text-sm font-medium text-white bg-gradient-to-r from-primary-500 to-primary-600 border border-transparent rounded-xl hover:from-primary-600 hover:to-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500" data-translate="Save">Save</button>
            </div>
        </form>
=======
                <div class="modal-footer justify-content-between">
                    <button type="button" class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-dark-700 border border-gray-300 dark:border-dark-600 rounded-xl hover:bg-gray-50 dark:hover:bg-dark-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500" data-dismiss="modal" data-translate="Cancel">Cancel</button>
                    <button type="submit" class="px-4 py-2 text-sm font-medium text-white bg-gradient-to-r from-primary-500 to-primary-600 border border-transparent rounded-xl hover:from-primary-600 hover:to-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500" data-translate="Save">Save</button>
                </div>
            </form>
        </div>
        <!-- /.modal-content -->

    </div>
</div>

<div id="modal_pause_client" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
    <div class="bg-white dark:bg-dark-800 rounded-2xl shadow-2xl w-full max-w-md">
        <div class="flex items-center justify-between p-6 border-b border-gray-200 dark:border-dark-700 bg-warning-100 dark:bg-warning-900/20">
            <h4 class="text-lg font-semibold text-gray-900 dark:text-white" data-translate="Disable">Disable</h4>
            <button type="button" onclick="document.getElementById('modal_pause_client').style.display='none'" class="p-2 hover:bg-gray-100 dark:hover:bg-dark-700 rounded-lg">
                <i class="fas fa-times text-gray-400"></i>
            </button>
        </div>
        <div class="p-6" id="modal_pause_client_body"></div>
        <div class="flex justify-end space-x-3 rtl:space-x-reverse p-6 pt-0">
            <button type="button" onclick="document.getElementById('modal_pause_client').style.display='none'" class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-dark-700 border border-gray-300 dark:border-dark-600 rounded-xl hover:bg-gray-50 dark:hover:bg-dark-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500" data-translate="Cancel">Cancel</button>
            <button type="button" id="pause_client_confirm" class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-dark-700 border border-gray-300 dark:border-dark-600 rounded-xl hover:bg-gray-50 dark:hover:bg-dark-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500" data-translate="Apply">Apply</button>
=======
<div class="modal fade" id="modal_pause_client">
    <div class="modal-dialog">
        <div class="modal-content bg-warning">
            <div class="modal-header">
                <h4 class="modal-title" data-translate="Disable">Disable</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
            </div>
            <div class="modal-footer justify-content-between">
                <button type="button" class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-dark-700 border border-gray-300 dark:border-dark-600 rounded-xl hover:bg-gray-50 dark:hover:bg-dark-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500" data-dismiss="modal" data-translate="Cancel">Cancel</button>
                <button type="button" class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-dark-700 border border-gray-300 dark:border-dark-600 rounded-xl hover:bg-gray-50 dark:hover:bg-dark-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500" id="pause_client_confirm" data-translate="Apply">Apply</button>
            </div>

        </div>
    </div>
</div>

<div id="modal_remove_client" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
    <div class="bg-white dark:bg-dark-800 rounded-2xl shadow-2xl w-full max-w-md">
        <div class="flex items-center justify-between p-6 border-b border-gray-200 dark:border-dark-700 bg-danger-100 dark:bg-danger-900/20">
            <h4 class="text-lg font-semibold text-gray-900 dark:text-white" data-translate="Remove">Remove</h4>
            <button type="button" onclick="document.getElementById('modal_remove_client').style.display='none'" class="p-2 hover:bg-gray-100 dark:hover:bg-dark-700 rounded-lg">
                <i class="fas fa-times text-gray-400"></i>
            </button>
        </div>
        <div class="p-6" id="modal_remove_client_body"></div>
        <div class="flex justify-end space-x-3 rtl:space-x-reverse p-6 pt-0">
            <button type="button" onclick="document.getElementById('modal_remove_client').style.display='none'" class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-dark-700 border border-gray-300 dark:border-dark-600 rounded-xl hover:bg-gray-50 dark:hover:bg-dark-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500" data-translate="Cancel">Cancel</button>
            <button type="button" id="remove_client_confirm" class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-dark-700 border border-gray-300 dark:border-dark-600 rounded-xl hover:bg-gray-50 dark:hover:bg-dark-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500" data-translate="Apply">Apply</button>

<div class="modal fade" id="modal_remove_client">
    <div class="modal-dialog">
        <div class="modal-content bg-danger">
            <div class="modal-header">
                <h4 class="modal-title" data-translate="Remove">Remove</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
            </div>
            <div class="modal-footer justify-content-between">
                <button type="button" class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-dark-700 border border-gray-300 dark:border-dark-600 rounded-xl hover:bg-gray-50 dark:hover:bg-dark-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500" data-dismiss="modal" data-translate="Cancel">Cancel</button>
                <button type="button" class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-dark-700 border border-gray-300 dark:border-dark-600 rounded-xl hover:bg-gray-50 dark:hover:bg-dark-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500" id="remove_client_confirm" data-translate="Apply">Apply</button>
            </div>

        </div>
    </div>
</div>
                <span data-translate="QR Code">QR Code</span>
            </h3>
            <button onclick="document.getElementById('modal_qr_code').style.display='none'" class="p-2 hover:bg-gray-100 dark:hover:bg-dark-700 rounded-lg">
                <i class="fas fa-times text-gray-400"></i>
            </button>
        </div>
        
        <div class="p-6 text-center">
            <div class="bg-gray-100 dark:bg-dark-700 rounded-xl p-4 mb-4">
                <img id="qr-code-image" src="" alt="QR Code" class="w-full h-auto max-w-xs mx-auto">
            </div>
            <p class="text-sm text-gray-600 dark:text-gray-400" data-translate="Scan this QR code with your Wireguard client">Scan this QR code with your Wireguard client</p>
        </div>
    </div>
</div>
{{end}}

{{define "bottom_js"}}
<script>
// Global variables
let clients = [];
let filteredClients = [];
let autoRefreshInterval = null;
let isLoading = false;

// DOM elements
const clientsContainer = document.getElementById('clients-container');
const loadingState = document.getElementById('loading-state');
const emptyState = document.getElementById('empty-state');
const searchInput = document.getElementById('search-input');
const statusFilter = document.getElementById('status-filter');
const autoRefreshToggle = document.getElementById('auto-refresh-toggle');
const refreshBtn = document.getElementById('refresh-status-btn');

// Statistics elements
const totalClientsEl = document.getElementById('total-clients');
const onlineClientsEl = document.getElementById('online-clients');
const totalTransferEl = document.getElementById('total-transfer');
const serverStatusEl = document.getElementById('server-status');

// Initialize
document.addEventListener('DOMContentLoaded', function() {
    loadClients();
    bindEvents();
    updateStats();
});

// Bind events
function bindEvents() {
    searchInput.addEventListener('input', debounce(filterClients, 300));
    statusFilter.addEventListener('change', filterClients);
    autoRefreshToggle.addEventListener('change', toggleAutoRefresh);
    refreshBtn.addEventListener('click', loadClients);
}

// Load clients from server
async function loadClients() {
    if (isLoading) return;
    
    isLoading = true;
    showLoading();
    
    try {
        const response = await fetch(`${basePath}/api/clients`);
        if (response.ok) {
            const data = await response.json();
            clients = data.clients || [];
            filteredClients = [...clients];
            renderClients();
            updateStats();
        } else {
            throw new Error('Failed to load clients');
        }
    } catch (error) {
        console.error('Error loading clients:', error);
        showError('Failed to load clients. Please try again.');
    } finally {
        isLoading = false;
        hideLoading();
    }
}

// Show loading state
function showLoading() {
    loadingState.classList.remove('hidden');
    clientsContainer.classList.add('hidden');
    emptyState.classList.add('hidden');
}

// Hide loading state
function hideLoading() {
    loadingState.classList.add('hidden');
    clientsContainer.classList.remove('hidden');
}

// Filter clients
function filterClients() {
    const searchTerm = searchInput.value.toLowerCase();
    const statusFilterValue = statusFilter.value;
    
    filteredClients = clients.filter(client => {
        const matchesSearch = client.name.toLowerCase().includes(searchTerm) ||
                             client.email.toLowerCase().includes(searchTerm) ||
                             client.allocated_ips.some(ip => ip.includes(searchTerm));
        
        const matchesStatus = statusFilterValue === 'all' || 
                             client.status === statusFilterValue ||
                             (statusFilterValue === 'enabled' && client.enabled) ||
                             (statusFilterValue === 'disabled' && !client.enabled);
        
        return matchesSearch && matchesStatus;
    });
    
    renderClients();
}

// Render clients
function renderClients() {
    if (filteredClients.length === 0) {
        clientsContainer.classList.add('hidden');
        emptyState.classList.remove('hidden');
        return;
    }
    
    clientsContainer.classList.remove('hidden');
    emptyState.classList.add('hidden');
    
    clientsContainer.innerHTML = filteredClients.map(client => createClientCard(client)).join('');
}

// Create client card HTML
function createClientCard(client) {
    const isOnline = client.status === 'online';
    const statusColor = isOnline ? 'bg-green-500' : 'bg-gray-400';
    const statusText = isOnline ? 'Online' : 'Offline';
    const transferData = formatBytes(client.transfer_rx + client.transfer_tx);
    
    return `
        <div class="client-card bg-white dark:bg-dark-800 rounded-2xl shadow-lg border border-gray-200 dark:border-dark-700 overflow-hidden">
            <!-- Client Header -->
            <div class="p-6 border-b border-gray-200 dark:border-dark-700">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <div class="relative">
                            <div class="w-12 h-12 bg-gradient-to-br from-primary-500 to-primary-600 rounded-xl flex items-center justify-center text-white font-bold text-lg">
                                ${client.name.charAt(0).toUpperCase()}
                            </div>
                            <div class="absolute -bottom-1 -right-1 w-4 h-4 ${statusColor} rounded-full border-2 border-white dark:border-dark-800"></div>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white">${client.name}</h3>
                            <p class="text-sm text-gray-500 dark:text-gray-400">${client.email}</p>
                        </div>
                    </div>
                    
                    <div class="flex items-center space-x-2">
                        <span class="status-badge px-3 py-1 text-xs font-medium rounded-full ${isOnline ? 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200' : 'bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-200'}">
                            ${statusText}
                        </span>
                        <div class="flex items-center space-x-1">
                            <button onclick="editClient('${client.id}')" class="action-button p-2 text-gray-400 hover:text-primary-500 rounded-lg hover:bg-gray-100 dark:hover:bg-dark-700">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="showQRCode('${client.id}')" class="action-button p-2 text-gray-400 hover:text-primary-500 rounded-lg hover:bg-gray-100 dark:hover:bg-dark-700">
                                <i class="fas fa-qrcode"></i>
                            </button>
                            <button onclick="toggleClient('${client.id}')" class="action-button p-2 text-gray-400 hover:text-primary-500 rounded-lg hover:bg-gray-100 dark:hover:bg-dark-700">
                                <i class="fas fa-${client.enabled ? 'pause' : 'play'}"></i>
                            </button>
                            <button onclick="deleteClient('${client.id}')" class="action-button p-2 text-gray-400 hover:text-red-500 rounded-lg hover:bg-gray-100 dark:hover:bg-dark-700">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Client Details -->
            <div class="p-6 space-y-4">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <p class="text-sm text-gray-500 dark:text-gray-400">IP Address</p>
                        <p class="text-sm font-medium text-gray-900 dark:text-white">${client.allocated_ips.join(', ')}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500 dark:text-gray-400">Data Transfer</p>
                        <p class="text-sm font-medium text-gray-900 dark:text-white">${transferData}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500 dark:text-gray-400">Last Seen</p>
                        <p class="text-sm font-medium text-gray-900 dark:text-white">${client.last_handshake || 'Never'}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500 dark:text-gray-400">Quota</p>
                        <p class="text-sm font-medium text-gray-900 dark:text-white">${client.quota ? formatBytes(client.quota) : 'Unlimited'}</p>
                    </div>
                </div>
                
                ${client.notes ? `
                <div class="bg-gray-50 dark:bg-dark-700 rounded-xl p-3">
                    <p class="text-sm text-gray-700 dark:text-gray-300">${client.notes}</p>
                </div>
                ` : ''}
            </div>
        </div>
    `;
}

// Update statistics
function updateStats() {
    const totalClients = clients.length;
    const onlineClients = clients.filter(c => c.status === 'online').length;
    const totalTransfer = clients.reduce((sum, c) => sum + c.transfer_rx + c.transfer_tx, 0);
    
    totalClientsEl.textContent = totalClients;
    onlineClientsEl.textContent = onlineClients;
    totalTransferEl.textContent = formatBytes(totalTransfer);
    
    // Animate counters
    animateCounter(totalClientsEl, totalClients);
    animateCounter(onlineClientsEl, onlineClients);
}

// Animate counter
function animateCounter(element, target) {
    const start = parseInt(element.textContent) || 0;
    const duration = 1000;
    const startTime = performance.now();
    
    function update(currentTime) {
        const elapsed = currentTime - startTime;
        const progress = Math.min(elapsed / duration, 1);
        const current = Math.floor(start + (target - start) * progress);
        
        element.textContent = current;
        
        if (progress < 1) {
            requestAnimationFrame(update);
        }
    }
    
    requestAnimationFrame(update);
}

// Toggle auto refresh
function toggleAutoRefresh() {
    if (autoRefreshToggle.checked) {
        autoRefreshInterval = setInterval(loadClients, 10000); // 10 seconds
    } else {
        clearInterval(autoRefreshInterval);
    }
}

// Client actions
function editClient(clientId) {
    const client = clients.find(c => c.id === clientId);
    if (!client) return;
    
    document.getElementById('edit-client-id').value = client.id;
    document.getElementById('edit-client-name').value = client.name;
    document.getElementById('edit-client-email').value = client.email;
    document.getElementById('edit-client-quota').value = client.quota ? client.quota / (1024 * 1024 * 1024) : '';
    document.getElementById('edit-client-expiry').value = client.expiry_days || '';
    document.getElementById('edit-client-notes').value = client.notes || '';
    document.getElementById('edit-client-enabled').checked = client.enabled;
    document.getElementById('edit-client-dns').checked = client.use_server_dns;
    
    document.getElementById('modal_edit_client').style.display = 'block';
}

function showQRCode(clientId) {
    const client = clients.find(c => c.id === clientId);
    if (!client) return;
    
    document.getElementById('qr-code-image').src = `${basePath}/api/client/${clientId}/qr`;
    document.getElementById('modal_qr_code').style.display = 'block';
}

function toggleClient(clientId) {
    const client = clients.find(c => c.id === clientId);
    if (!client) return;
    
    // Toggle client enabled state
    fetch(`${basePath}/api/client/${clientId}/toggle`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            loadClients();
            showSuccess(`Client ${client.enabled ? 'disabled' : 'enabled'} successfully`);
        } else {
            showError('Failed to toggle client');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        showError('Failed to toggle client');
    });
}

function deleteClient(clientId) {
    const client = clients.find(c => c.id === clientId);
    if (!client) return;
    
    if (confirm(`Are you sure you want to delete client "${client.name}"?`)) {
        fetch(`${basePath}/api/client/${clientId}`, {
            method: 'DELETE',
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                loadClients();
                showSuccess('Client deleted successfully');
            } else {
                showError('Failed to delete client');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            showError('Failed to delete client');
        });
    }
}

// Utility functions
function formatBytes(bytes) {
    if (bytes === 0) return '0 B';
    const k = 1024;
    const sizes = ['B', 'KB', 'MB', 'GB', 'TB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}

function showSuccess(message) {
    // You can integrate with a toast library here
    console.log('Success:', message);
}

function showError(message) {
    // You can integrate with a toast library here
    console.error('Error:', message);
}

// Global base path
const basePath = '{{.basePath}}';

// Handle edit client form submission
document.getElementById('edit-client-form').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    const clientId = formData.get('client_id');
    
    fetch(`${basePath}/api/client/${clientId}`, {
        method: 'PUT',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            name: formData.get('client_name'),
            email: formData.get('client_email'),
            quota: formData.get('client_quota') ? parseFloat(formData.get('client_quota')) * 1024 * 1024 * 1024 : null,
            expiry_days: formData.get('client_expiry') ? parseInt(formData.get('client_expiry')) : null,
            notes: formData.get('client_notes'),
            enabled: formData.get('client_enabled') === 'on',
            use_server_dns: formData.get('client_dns') === 'on',
        }),
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            document.getElementById('modal_edit_client').style.display = 'none';
            loadClients();
            showSuccess('Client updated successfully');
        } else {
            showError('Failed to update client');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        showError('Failed to update client');
    });
});
</script>
{{end}}
