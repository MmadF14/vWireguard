{{define "title"}}
System Status
{{end}}

{{define "page_title"}}
System Status
{{end}}

{{define "page_content"}}
<section class="content">
    <div class="container-fluid">
        <!-- System Resources -->
        <div class="row">
            <!-- CPU Usage -->
            <div class="col-md-3">
                <div class="card">
                    <div class="card-body text-center">
                        <div class="resource-gauge mb-3">
                            <canvas id="cpuGauge"></canvas>
                        </div>
                        <h5 class="mb-0">CPU Usage</h5>
                        <div id="cpuDetails" class="text-muted"></div>
                    </div>
                </div>
            </div>
            
            <!-- Memory Usage -->
            <div class="col-md-3">
                <div class="card">
                    <div class="card-body text-center">
                        <div class="resource-gauge mb-3">
                            <canvas id="ramGauge"></canvas>
                        </div>
                        <h5 class="mb-0">Memory Usage</h5>
                        <div id="ramDetails" class="text-muted"></div>
                    </div>
                </div>
            </div>
            
            <!-- Swap Usage -->
            <div class="col-md-3">
                <div class="card">
                    <div class="card-body text-center">
                        <div class="resource-gauge mb-3">
                            <canvas id="swapGauge"></canvas>
                        </div>
                        <h5 class="mb-0">Swap Usage</h5>
                        <div id="swapDetails" class="text-muted"></div>
                    </div>
                </div>
            </div>
            
            <!-- Disk Usage -->
            <div class="col-md-3">
                <div class="card">
                    <div class="card-body text-center">
                        <div class="resource-gauge mb-3">
                            <canvas id="diskGauge"></canvas>
                        </div>
                        <h5 class="mb-0">Disk Usage</h5>
                        <div id="diskDetails" class="text-muted"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- System Information -->
        <div class="row mt-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">System Information</h3>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="info-box bg-dark">
                                    <span class="info-box-icon"><i class="fas fa-microchip"></i></span>
                                    <div class="info-box-content">
                                        <span class="info-box-text">System Load</span>
                                        <span id="systemLoad" class="info-box-number"></span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="info-box bg-dark">
                                    <span class="info-box-icon"><i class="fas fa-clock"></i></span>
                                    <div class="info-box-content">
                                        <span class="info-box-text">Uptime</span>
                                        <span id="systemUptime" class="info-box-number"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Network Status</h3>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="info-box bg-dark">
                                    <span class="info-box-icon"><i class="fas fa-upload"></i></span>
                                    <div class="info-box-content">
                                        <span class="info-box-text">Upload</span>
                                        <span id="uploadSpeed" class="info-box-number"></span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="info-box bg-dark">
                                    <span class="info-box-icon"><i class="fas fa-download"></i></span>
                                    <div class="info-box-content">
                                        <span class="info-box-text">Download</span>
                                        <span id="downloadSpeed" class="info-box-number"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-md-6">
                                <div class="info-box bg-dark">
                                    <span class="info-box-icon"><i class="fas fa-cloud-upload-alt"></i></span>
                                    <div class="info-box-content">
                                        <span class="info-box-text">Total Upload</span>
                                        <span id="totalUpload" class="info-box-number"></span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="info-box bg-dark">
                                    <span class="info-box-icon"><i class="fas fa-cloud-download-alt"></i></span>
                                    <div class="info-box-content">
                                        <span class="info-box-text">Total Download</span>
                                        <span id="totalDownload" class="info-box-number"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Network Information -->
        <div class="row mt-4">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Network Information</h3>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-3">
                                <div class="info-box bg-dark">
                                    <span class="info-box-icon"><i class="fas fa-network-wired"></i></span>
                                    <div class="info-box-content">
                                        <span class="info-box-text">IPv4</span>
                                        <span id="ipv4Status" class="info-box-number">Enabled</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="info-box bg-dark">
                                    <span class="info-box-icon"><i class="fas fa-network-wired"></i></span>
                                    <div class="info-box-content">
                                        <span class="info-box-text">IPv6</span>
                                        <span id="ipv6Status" class="info-box-number">Enabled</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="info-box bg-dark">
                                    <span class="info-box-icon"><i class="fas fa-random"></i></span>
                                    <div class="info-box-content">
                                        <span class="info-box-text">TCP Port</span>
                                        <span id="tcpPort" class="info-box-number">47815</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="info-box bg-dark">
                                    <span class="info-box-icon"><i class="fas fa-random"></i></span>
                                    <div class="info-box-content">
                                        <span class="info-box-text">UDP Port</span>
                                        <span id="udpPort" class="info-box-number">787</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{{end}}

{{define "bottom_js"}}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Gauge configuration
    const gaugeConfig = {
        type: 'doughnut',
        data: {
            datasets: [{
                data: [0, 100],
                backgroundColor: ['#00bc8c', '#375a7f']
            }]
        },
        options: {
            circumference: 180,
            rotation: -90,
            cutout: '75%',
            plugins: {
                tooltip: { enabled: false },
                legend: { display: false }
            },
            responsive: true,
            maintainAspectRatio: true
        }
    };

    // Initialize gauges
    const gauges = {
        cpu: new Chart(document.getElementById('cpuGauge'), {...gaugeConfig}),
        ram: new Chart(document.getElementById('ramGauge'), {...gaugeConfig}),
        swap: new Chart(document.getElementById('swapGauge'), {...gaugeConfig}),
        disk: new Chart(document.getElementById('diskGauge'), {...gaugeConfig})
    };

    function updateGauge(gauge, value, total, usedLabel) {
        const percentage = (value / total * 100).toFixed(2);
        gauge.data.datasets[0].data = [percentage, 100 - percentage];
        gauge.update();
        return percentage;
    }

    function formatBytes(bytes, decimals = 2) {
        if (bytes === 0) return '0 Bytes';
        const k = 1024;
        const dm = decimals < 0 ? 0 : decimals;
        const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
    }

    function updateSystemStatus() {
        $.ajax({
            url: '{{.basePath}}/api/system-status',
            method: 'GET',
            success: function(data) {
                // Update CPU
                const cpuPercentage = updateGauge(gauges.cpu, data.cpu.used, 100);
                $('#cpuDetails').text(`${data.cpu.cores} Cores | ${cpuPercentage}%`);

                // Update RAM
                const ramPercentage = updateGauge(gauges.ram, data.memory.used, data.memory.total);
                $('#ramDetails').text(`${formatBytes(data.memory.used)} / ${formatBytes(data.memory.total)}`);

                // Update Swap
                const swapPercentage = updateGauge(gauges.swap, data.swap.used, data.swap.total);
                $('#swapDetails').text(`${formatBytes(data.swap.used)} / ${formatBytes(data.swap.total)}`);

                // Update Disk
                const diskPercentage = updateGauge(gauges.disk, data.disk.used, data.disk.total);
                $('#diskDetails').text(`${formatBytes(data.disk.used)} / ${formatBytes(data.disk.total)}`);

                // Update System Load
                $('#systemLoad').text(`${data.load[0]} | ${data.load[1]} | ${data.load[2]}`);

                // Update Uptime
                $('#systemUptime').text(data.uptime);

                // Update Network Stats
                $('#uploadSpeed').text(formatBytes(data.network.uploadSpeed) + '/s');
                $('#downloadSpeed').text(formatBytes(data.network.downloadSpeed) + '/s');
                $('#totalUpload').text(formatBytes(data.network.totalUpload));
                $('#totalDownload').text(formatBytes(data.network.totalDownload));

                // Update Network Information
                $('#ipv4Status').text(data.network.ipv4 ? 'Enabled' : 'Disabled');
                $('#ipv6Status').text(data.network.ipv6 ? 'Enabled' : 'Disabled');
                $('#tcpPort').text(data.network.tcpPort);
                $('#udpPort').text(data.network.udpPort);
            },
            error: function(xhr, status, error) {
                console.error('Error fetching system status:', error);
                toastr.error('Failed to fetch system status');
            }
        });
    }

    // Update status every 5 seconds
    $(document).ready(function() {
        updateSystemStatus();
        setInterval(updateSystemStatus, 5000);
    });
</script>
{{end}} 