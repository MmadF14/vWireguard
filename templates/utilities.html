{{define "title"}}
<span data-translate="System Utilities">System Utilities</span>
{{end}}

{{define "top_css"}}
{{end}}

{{define "username"}}
{{ .username }}
{{end}}

{{define "page_title"}}
<span data-translate="System Utilities">System Utilities</span>
{{end}}

{{define "page_content"}}
<section class="content">
    <div class="container-fluid">
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title" data-translate="System Tools">System Tools</h3>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="log-level" data-translate="Log Level">Log Level</label>
                                    <select class="form-control" id="log-level">
                                        <option value="DEBUG" data-translate="Debug">Debug</option>
                                        <option value="INFO" data-translate="Info">Info</option>
                                        <option value="WARN" data-translate="Warning">Warning</option>
                                        <option value="ERROR" data-translate="Error">Error</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <button type="button" class="btn btn-primary" id="restart-wg" data-translate="Restart WireGuard Service">Restart WireGuard Service</button>
                                <button type="button" class="btn btn-primary" id="flush-dns" data-translate="Flush DNS Cache">Flush DNS Cache</button>
                                <button type="button" class="btn btn-primary" id="check-updates" data-translate="Check for Updates">Check for Updates</button>
                                <button type="button" class="btn btn-primary" id="generate-report" data-translate="Generate System Report">Generate System Report</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
$(document).ready(function() {
    // Set initial log level
    $('#log-level').val('{{ .logLevel }}');

    // Handle log level change
    $('#log-level').change(function() {
        const level = $(this).val();
        $.ajax({
            url: '{{ .basePath }}/api/settings/log-level',
            method: 'POST',
            contentType: 'application/json',
            data: JSON.stringify({ level: level }),
            success: function(response) {
                if (response.success) {
                    toastr.success('Log level updated successfully');
                } else {
                    toastr.error(response.message);
                }
            },
            error: function() {
                toastr.error('Failed to update log level');
            }
        });
    });

    // Handle WireGuard restart
    $('#restart-wg').click(function() {
        if (confirm('Are you sure you want to restart the WireGuard service?')) {
            $.ajax({
                url: '{{ .basePath }}/api/utilities/restart-wg',
                method: 'POST',
                success: function(response) {
                    if (response.success) {
                        toastr.success('WireGuard service restarted successfully');
                    } else {
                        toastr.error(response.message);
                    }
                },
                error: function() {
                    toastr.error('Failed to restart WireGuard service');
                }
            });
        }
    });

    // Handle DNS cache flush
    $('#flush-dns').click(function() {
        if (confirm('Are you sure you want to flush the DNS cache?')) {
            $.ajax({
                url: '{{ .basePath }}/api/utilities/flush-dns',
                method: 'POST',
                success: function(response) {
                    if (response.success) {
                        toastr.success('DNS cache flushed successfully');
                    } else {
                        toastr.error(response.message);
                    }
                },
                error: function() {
                    toastr.error('Failed to flush DNS cache');
                }
            });
        }
    });

    // Handle update check
    $('#check-updates').click(function() {
        $.ajax({
            url: '{{ .basePath }}/api/utilities/check-updates',
            method: 'POST',
            success: function(response) {
                if (response.success) {
                    toastr.success('Update check completed successfully');
                } else {
                    toastr.error(response.message);
                }
            },
            error: function() {
                toastr.error('Failed to check for updates');
            }
        });
    });

    // Handle system report generation
    $('#generate-report').click(function() {
        $.ajax({
            url: '{{ .basePath }}/api/utilities/generate-report',
            method: 'POST',
            success: function(response) {
                if (response.success) {
                    toastr.success('System report generated successfully');
                } else {
                    toastr.error(response.message);
                }
            },
            error: function() {
                toastr.error('Failed to generate system report');
            }
        });
    });
});
</script>
{{end}} 